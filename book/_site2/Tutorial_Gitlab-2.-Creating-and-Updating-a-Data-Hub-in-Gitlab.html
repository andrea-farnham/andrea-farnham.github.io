<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="G.Fraga Gonzalez &amp; E. Furrer">
<meta name="dcterms.date" content="2023-11-20">

<title>Gitlab Tutorial 2 - Creating and Updating a Data Hub</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<meta name="mermaid-theme" content="default">
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Tutorial_Gitlab-1.-Using-Gitlab-for-Project-Owners-and-Collaborators.html">Gitlab Tutorials</a></li><li class="breadcrumb-item"><a href="./Tutorial_Gitlab-2.-Creating-and-Updating-a-Data-Hub-in-Gitlab.html">Tutorial 2</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Tutorials</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Gitlab Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tutorial_Gitlab-1.-Using-Gitlab-for-Project-Owners-and-Collaborators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tutorial_Gitlab-2.-Creating-and-Updating-a-Data-Hub-in-Gitlab.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Tutorial 2</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="-1">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#workflow" id="toc-workflow" class="nav-link active" data-scroll-target="#workflow">Workflow</a>
  <ul class="collapse">
  <li><a href="#hub-content" id="toc-hub-content" class="nav-link" data-scroll-target="#hub-content">Hub content</a></li>
  <li><a href="#required-files" id="toc-required-files" class="nav-link" data-scroll-target="#required-files">Required Files</a></li>
  <li><a href="#privacy" id="toc-privacy" class="nav-link" data-scroll-target="#privacy">Privacy</a></li>
  </ul></li>
  <li><a href="#required-actions-for-data-owners" id="toc-required-actions-for-data-owners" class="nav-link" data-scroll-target="#required-actions-for-data-owners">Required actions (for data owners)</a>
  <ul class="collapse">
  <li><a href="#action-edit-metadata" id="toc-action-edit-metadata" class="nav-link" data-scroll-target="#action-edit-metadata">1. ACTION: edit <strong>metadata</strong></a></li>
  <li><a href="#auto-changes-in-the-repository-trigger-the-continuous-integration-pipeline" id="toc-auto-changes-in-the-repository-trigger-the-continuous-integration-pipeline" class="nav-link" data-scroll-target="#auto-changes-in-the-repository-trigger-the-continuous-integration-pipeline">2. AUTO: changes in the repository <strong>trigger the Continuous Integration pipeline</strong></a></li>
  <li><a href="#auto-the-continuous-integration-pipeline-runs-the-script" id="toc-auto-the-continuous-integration-pipeline-runs-the-script" class="nav-link" data-scroll-target="#auto-the-continuous-integration-pipeline-runs-the-script">3. AUTO: the continuous integration pipeline <strong>runs the script</strong></a></li>
  <li><a href="#auto-the-html-is-updated-and-collaborators-can-navigate-through-the-updated-data" id="toc-auto-the-html-is-updated-and-collaborators-can-navigate-through-the-updated-data" class="nav-link" data-scroll-target="#auto-the-html-is-updated-and-collaborators-can-navigate-through-the-updated-data">4. AUTO: The HTML is updated and collaborators can navigate through the updated data</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Gitlab Tutorial 2 - Creating and Updating a Data Hub</h1>
<p class="subtitle lead">A workflow to use Gitlab pages as an open data hub</p>
  <div class="quarto-categories">
    <div class="quarto-category">Gitlab</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>G.Fraga Gonzalez &amp; E. Furrer </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 20, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><a href="./index.html">Back</a></p>
<section id="workflow" class="level1">
<h1>Workflow</h1>
<p>Here we propose to use <a href="https://docs.gitlab.com/ee/user/project/pages/">Gitlab pages</a> to host an easy-to-build website where we can share documentation, metadata and some data (e.g., preview images) of our projects. The website can be either public or private, requiring users to log in. We propose that this approach can be useful to improve the research workflow in many labs and projects, irrespective of whether they have a strong programming focus.</p>
<p>The different processes required for this workflow are explained in the tutorials in this website. They include step-by-step guides, templates, video demos and links intended for non-coders, as well as other tutorials for more advanced users.</p>
<p>The main <strong>requirements</strong> for this workflow are:</p>
<ul>
<li>(Required) A Gitlab repository and basic familiarity with it</li>
<li>(Required) A way of creating HTML pages: we provide R Quarto markdown templates</li>
<li>(Recommended) A Gitlab continuous integration script to allow updating the directly from the browser without having to clone the repo/push changes. We provide examples and templates.</li>
</ul>
<p>The basic workflow:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A1[data, metadata, code] &lt;.-&gt; |sync| B[Gitlab Repository]
    B0[Documentation] &lt;.-&gt;|edit Wiki| B
    B --&gt; | Render Gitlab Page| C[Hub]


</pre>
</div>
</div>
</div>
</div>
<section id="hub-content" class="level2">
<h2 class="anchored" data-anchor-id="hub-content">Hub content</h2>
<p>In this workflow we propose that the <code>owner</code> of the data (e.g., a lab or a researcher) creates and maintains a <strong>main Gitlab repository</strong> containing:</p>
<ol type="1">
<li><strong>Metadata tables</strong> e.g., CSV or Excel tables</li>
<li><strong>Data</strong>, if applicable, e.g., thumbnail images</li>
<li><strong>Scripts to render</strong> an HTML landing site, i.e.&nbsp;the Data Hub, which provides access for collaborators. This can be done without web development skill using in R markdown or R Quarto markdown.</li>
<li><strong>Documentation</strong> associated with those data is collected in the <strong>Wiki</strong> of the main repository. The advantage of using the Wiki is that it can be directly edited in the browser by anyone with permissions. If needed, the markdown files with the wiki pages could be downloaded (they are stored is a separate repository).</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note on metadata table formats
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gitlab can display and allows editing of .csv tables from the browser. For excel tables, you will need to download it for editing or work locally and then push the changes to the repository. Note that this refers to editing source files in the repository and not to the website, where tables are visible (but not editable) irrespective of the source table format (R Quarto scripts will read any format and render them in html format for interoperability and interactivity)</p>
</div>
</div>
<p>The files will have three <strong>URL locations</strong>, which can all be accessed through the main landing site (Data Hub):</p>
<ol type="1">
<li>The <strong>Landing page</strong> shows interactive tables to navigate data and metadata the documentation and has links to the main repository and the wiki.</li>
<li>The <strong>main repository</strong> to access the source metadata tables, data files and the code necessary to generate the Hub.</li>
<li>The <strong>Wiki</strong> to access all relevant documentation to understand how the data was collected and preprocessed, such as protocols and standard operating procedures (SOPs). It should also have information about filenames, folder structures and how metadata are organized. It is also accessible through the main repository.</li>
</ol>
</section>
<section id="required-files" class="level2">
<h2 class="anchored" data-anchor-id="required-files">Required Files</h2>
<p>The main <strong>input files</strong> are:</p>
<ul>
<li><code>metadata table</code> (preferrably in .csv format for interoperability). It should contain just the filename of the pictures that will be displayed</li>
<li><code>images</code> files (<strong>Note</strong>: Gitlab is not meant for data storage. Images should be compressed to avoid exceeding volume allowed per repo ( usually 5 Gb in free versions, <a href="https://about.gitlab.com/pricing/faq-paid-storage-transfer/">details here</a>)</li>
<li><code>R Quarto markdown</code> scripts that has the code to render the tables as well as some text with instructions</li>
<li>A <code>.gitlab-ci.yml</code> file is the Continuous integration file that makes it possible to run the Rmd file and render the html again from Gitlab</li>
</ul>
<p>The <strong>outputs</strong> for the website</p>
<ul>
<li>The <code>html</code> files that make up the website are</li>
</ul>
<p><strong>Note</strong>: <em>index.html</em> and <em>images folder</em> ARE EXPECTED to be saved in the <code>public</code> folder. This does not mean they are publicly accessible (you need login to access this site)</p>
</section>
<section id="privacy" class="level2">
<h2 class="anchored" data-anchor-id="privacy">Privacy</h2>
<p>This work flow can work in both a <code>private</code> or a <code>public</code> repository. If we want to keep access restricted we can set the repository as private. Then we need:</p>
<ul>
<li><strong>Accounts</strong>. A <a href="https://www.switch.ch/en/edu-id">SWITCH edu ID</a> account is required to access the hub website and the repository with the code to generate it</li>
<li><strong>Members</strong>. As owners of a repository we can set up different roles for the members that we allow access. Any member with the role of <code>maintainer</code> can add new members (Go to Manage/Members). They must also have maintainer role to be able to access the full-size images after clicking on the table thumbnail. Members enrolled as <code>guests</code> can only see the thumbnails but will not be able to access the full-size images.</li>
</ul>
<p>After having acquired permissions to access the repository, any <code>user/collaborator</code> can just go to the main website URL and access with the SWITCH-ID credentials</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note on accessibility
</div>
</div>
<div class="callout-body-container callout-body">
<p>The access to the website using SWITCH edu-id credentials works with Gitlab pages because it is supported by UZH ( <a href="https://www.zi.uzh.ch/en/teaching-and-research/software-elearning/webplatforms/gitlab.html">Gitlab.uzh</a>). If are using repositories at Gitlab.com, your collaborators will need a Gitlab account. If you use Github (with a free acount) instead of Gitlab you will not be able to make a private website, Github pages will only work with public repositories.</p>
</div>
</div>
</section>
</section>
<section id="required-actions-for-data-owners" class="level1">
<h1>Required actions (for data owners)</h1>
<p>Once the Continuous Integration (CI) file and R Quarto scripts are set, the only action required by the owner will be to edit the metadata tables and/or some of the content of the R Quarto files in the repository. Any change in the repository will trigger the CI pipeline and the website will be rendered again.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>

<pre class="mermaid mermaid-js">%%{
  init: {'theme':' ',
          'themeVariables': {
          'titleColor':'#F54E90',
          'mainBkg':'#4ef5b3',
          'clusterBkg':'#f2fcf8',
          'lineColor':'#F54E90',
          'edgeLabelBackground':'#F54E90',
          'nodeBorder': '',
          'clusterBorder': ''
          
      }
  }
}%%

flowchart LR
    subgraph 1. ACTION: Edit metadata
    Owner .-&gt; |local edits| B[Cloned copy]
    B .-&gt; |push| C[Metadata Table]    
    end
    Owner .-&gt; |edit in browser| C
    subgraph 2. AUTO: Trigger CI Pipeline
      direction TB
      C --&gt; |trigger| D[.gitlab-ci.yml]
    end
    subgraph 3. AUTO: run scripts
    D --&gt; |run| E[R Quarto script]
    end
    subgraph 4. AUTO:update website
    E --&gt; |render| F[Gitlab pages updated]
    end

    
    
    start1[ ] .-&gt;|manual|stop1[ ]
    start2[ ] --&gt;|automatic| stop2[ ]
      style start1 height:0px;
      style start2 height:0px;
      style stop1 height:0px;
      style stop2 height:0px;
    
 
 
</pre>
</div>
</div>
</div>
</div>
<section id="action-edit-metadata" class="level2">
<h2 class="anchored" data-anchor-id="action-edit-metadata">1. ACTION: edit <strong>metadata</strong></h2>
<p>The <code>owner</code> can do this through:</p>
<ol type="1">
<li><strong>Browser</strong> (<em>RECOMMENDED FOR MINOR CHANGES</em>) Making changes from Gitlab using the browser, e.g., upload or edit scripts.</li>
<li><strong>Clone repository</strong> (<em>RECOMMENDED FOR MAJOR UPDATES</em>) Cloning this repo, working locally and <em>committing</em> and <em>pushing</em> the changes to Gitlab (e.g., using <a href="https://desktop.github.com/">Github desktop</a>). The local metadata file should be always in Sync with that one in the remote repository.</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note on the source table
</div>
</div>
<div class="callout-body-container callout-body">
<p>This workflow considers the Gitlab repository as the <em>main source</em> for retrieving your projects’ metadata. Thus, we recommend to edit and maintain the tables in this repository and to avoid creating copies of those tables to prevent losing control over their versions.</p>
</div>
</div>
</section>
<section id="auto-changes-in-the-repository-trigger-the-continuous-integration-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="auto-changes-in-the-repository-trigger-the-continuous-integration-pipeline">2. AUTO: changes in the repository <strong>trigger the Continuous Integration pipeline</strong></h2>
<p>It may take around 5 minutes to update the page html. The member with at least <code>maintainer</code> status can click on Build/Pipelines or Jobs (sidebar in Gitlab) to see what pipeline or job (within pipeline) is running, and if there are any errors.</p>
</section>
<section id="auto-the-continuous-integration-pipeline-runs-the-script" class="level2">
<h2 class="anchored" data-anchor-id="auto-the-continuous-integration-pipeline-runs-the-script">3. AUTO: the continuous integration pipeline <strong>runs the script</strong></h2>
<p>The <em>.gitlab-ci.yml</em> file defines this pipeline. It uses a Docker image with R, Gitlab pages to produce the website, and Gitlab runner to run the Docker where we have our Rmarkdown script (rendering the html from the table). The owner can edit the yml and the Rmarkdown to make if changes in this flow are to be done. No edit of Docker image is needed.</p>
<p>See our tutorial on customizing Gitlab Continuous Integration for more advanced details.</p>
</section>
<section id="auto-the-html-is-updated-and-collaborators-can-navigate-through-the-updated-data" class="level2">
<h2 class="anchored" data-anchor-id="auto-the-html-is-updated-and-collaborators-can-navigate-through-the-updated-data">4. AUTO: The HTML is updated and collaborators can navigate through the updated data</h2>
<p>A <em>static site</em> like the one you are seeing this tutorial can include interactive elements. In this example we propose an <em>interactive table</em> that can be used to navigate through metadata and even some data (e.g., displaying clickable image thumbnails). By <em>static</em> we mean that the user will just see whatever data is contained in the HTML of the site. Although it contains an interactive table, all users have access to the same data which they cannot modify (unlike in <em>dynamic websites</em>).</p>
<p>The website hosted using <a href="https://docs.gitlab.com/ee/user/project/pages/">Gitlab pages</a> is rendered with an [R Markdown] (https://rmarkdown.rstudio.com/) script, that uses the R <a href="https://rstudio.github.io/DT/">DT package</a>). The script creates an interactive page in HTML. <a href="https://docs.gitlab.com/ee/ci/">Gitlab CI</a> is used to run the R Markdown script automatically at each update (push) and render the site from the browser so that users do not need to install R or other programs to update the site.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>