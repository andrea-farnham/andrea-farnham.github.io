{
  "hash": "d0cb304722bd9a4a1d943f2397d0accb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Make JSON metadata files\" \nsubtitle: \"Read fields from a table and apply to data files in a loop, reading file-specific information\"\nauthor:\n  - name: \"G.Fraga Gonzalez\"\n    orcid: '0000-0002-1857-8607'\n    affiliation: \"Center for Reproducible Science, UZH\"\n\ndate: last-modified\nformat: \n  html:\n    code-fold: show\neditor: visual\n---\n\n\n**Create a JSON file with metadata from tables and data files**\n\nIn this example we create simple human and machine-readable metadata files in JavaScript Object Notation [(JSON)](https://www.json.org/json-en.html). They consists of fields of key-value pairs. These are *sidecar* metadata files, that is, they accompany a separate source data file (for this example we use dummy images as data files). In this use case, researchers can edit a table specifying the fields in the JSON file. This script creates a JSON with these fields. Some of the values in the JSON fields are filled for each of the data files based on the filename and an additional table with metadata (subject information).\n\n\n:::{.callout-important collapse='false'}\nThere are good editors with a graphical interface available online to read and write JSON. We recommend the following website:\n[https://jsoneditoronline.org/](https://jsoneditoronline.org/)\n\nIn general, we recommend creating JSON files with a script and not manually, to prevent user entry errors. JSON metadata files are part of essential machine-readable metadata, and additional to structured metadata (tables) which may contain human-only readable columns (e.g., 'comment' variables wtih free text notes). JSON file can have more details than the metadata tables. \n\n::: \n\n\n\n\n![](images/banner_json-01.png){width=\"659\"}\n\nThis use case is based on:\n\n#### inputs\n\n-   A csv table specifying the JSON *keys* (e.g., \"SynchrotronName\",\"SpeciesName\" ) and their *values* (e.g., \"mouse\") when they apply to all files. If a value is blank it will be filled by information in the filename or table with subject information (see below)\n\n-   A collection of data files encoding subject ID in their name.\n\n-   An Excel table with subjects information (e.g.,sex, body weight) that has to be added to the JSON file\n\nWe will use the R package [jsonlite](https://cran.r-project.org/web/packages/jsonlite/index.html) to write the JSON string\n\n#### outputs\n\nA JSON file per data file with the fields from the table is created for each file with the same filename and the subject ID added in the corresponding json field. In this case the data files are images from mice.\n\n::: {.callout-note collapse=\"false\"}\n# Note on this example\n\nThis demo uses a dummy data set, i.e., the JSON fields and metadata have no real-life meaning. We use tables in different formats (csv and Excel) as this can happen in actual projects (csv format is preferred over Excel, for interoperability).\n:::\n\n::: panel-tabset\n# How-to\n\n### Read table with JSON fields and table with subjects information\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(knitr)\nlibrary(dplyr)\nlibrary(kableExtra)\n\n# Enter input directories \ndirinput <- 'dummy_data'\ndiroutput <- '../../_data/'\n\n# Read table with JSON fields \njsonFields <- read.csv(file.path(dirinput,'Dummy_JSON_fields.csv'))\n\n# Read table with subject information\nsubj_info <- openxlsx::read.xlsx(file.path(dirinput,'DummyData1_20241234_subjects.xlsx'), sheet = 'subject_info')\n```\n:::\n\n\n### Read data filenames and separate subject ID\n\nHere we read some .jpg pictures with dummy images. The first filename part contains the subject ID.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create table filenames \nfiles <- dir(file.path(dirinput,'Images')) # Find all files in our images folder\n\n# Use pattern to take only subject images\nfname <- files[grepl(paste0('^DS.*.jpg$'),files)] \ntbl_files <- as.data.frame(fname) \n\n# First filename part contains subject ID\ntbl_files$subject <- sapply(strsplit(fname,'_'),'[[',1) \n```\n:::\n\n\n### Check input tables\n\n::: panel-tabset\n## JSON fields\n\nIn this table we created the column **Data.name** that indicates the *key* and the column **Permissible.values** which will indicate the *value* in the JSON file. The other columns are not necessary for this example, but can help the users when specifying the content of their JSON files. The entries in Permissible.values will be filled with file-specific information.\n\n:::{.callout-important }\nThe names of these columns are arbitrary and you can define any other name. It is important to note the format of the values (e.g., numeric, alphanumeric or strings). The values can also be arrays `[1,2,3]`. A JSON file can have a more hierarchical structure with keys and subkeys. In this example we use a simple structure. \n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# check \nknitr::kable(jsonFields) %>%\n  scroll_box(height= \"300px\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; \"><table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> JSON_section </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> Data.name </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> Data.Description </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> Data.type </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> Permissible.values </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> SynchrotronName </td>\n   <td style=\"text-align:left;\"> Name of the synchrotron facility </td>\n   <td style=\"text-align:left;\"> string </td>\n   <td style=\"text-align:left;\"> Dummy-synchrotron </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> SynchrotronAcronym </td>\n   <td style=\"text-align:left;\"> Acronym of the synchrotron facility </td>\n   <td style=\"text-align:left;\"> string </td>\n   <td style=\"text-align:left;\"> Sync1234 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> IntendedFor </td>\n   <td style=\"text-align:left;\"> Name of the source file this metadata describes </td>\n   <td style=\"text-align:left;\"> string </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> BeamlineAcronym </td>\n   <td style=\"text-align:left;\"> Institution defined name of the machine. Corresponds to DICOM Tag DICOM tag 0008,1010. </td>\n   <td style=\"text-align:left;\"> string </td>\n   <td style=\"text-align:left;\"> BL20B2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> BeamtimeSessionStartDate </td>\n   <td style=\"text-align:left;\"> YYYY-MM-DD </td>\n   <td style=\"text-align:left;\"> date </td>\n   <td style=\"text-align:left;\"> 2024-01-13 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> BeamtimeSessionEndDate </td>\n   <td style=\"text-align:left;\"> YYYY-MM-DD </td>\n   <td style=\"text-align:left;\"> date </td>\n   <td style=\"text-align:left;\"> 2024-01-13 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> SpeciesName </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> string </td>\n   <td style=\"text-align:left;\"> mouse (mus musculus) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> SpeciesStrain </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> alphanumeric </td>\n   <td style=\"text-align:left;\"> C123456 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> SubjectID </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> alphanumeric </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> Sex </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> alphanumeric </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> BodyWeight_gr </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> number </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Info </td>\n   <td style=\"text-align:left;\"> BodyPart </td>\n   <td style=\"text-align:left;\"> Name of the organ / body region scanned. Corresponds to DICOM Tag DICOM tag 0018,0015. </td>\n   <td style=\"text-align:left;\"> string </td>\n   <td style=\"text-align:left;\"> brain </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Acquisition </td>\n   <td style=\"text-align:left;\"> DetectorArrayWidth </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> number </td>\n   <td style=\"text-align:left;\"> 123 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Acquisition </td>\n   <td style=\"text-align:left;\"> DetectorArrayHeight </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> number </td>\n   <td style=\"text-align:left;\"> 456 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Acquisition </td>\n   <td style=\"text-align:left;\"> DetectorBitDepth </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> number </td>\n   <td style=\"text-align:left;\"> 16 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Acquisition </td>\n   <td style=\"text-align:left;\"> DetectorPixelSize </td>\n   <td style=\"text-align:left;\"> in µm </td>\n   <td style=\"text-align:left;\"> number </td>\n   <td style=\"text-align:left;\"> 6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Acquisition </td>\n   <td style=\"text-align:left;\"> RotationAngle </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> number </td>\n   <td style=\"text-align:left;\"> 180 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Reconstruction </td>\n   <td style=\"text-align:left;\"> CenterOfRotationMethod </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> string </td>\n   <td style=\"text-align:left;\"> manual </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Reconstruction </td>\n   <td style=\"text-align:left;\"> CenterOfRotationValue </td>\n   <td style=\"text-align:left;\"> In pixels\" </td>\n   <td style=\"text-align:left;\"> number </td>\n   <td style=\"text-align:left;\"> 3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Reconstruction </td>\n   <td style=\"text-align:left;\"> ReconMatrixSize  </td>\n   <td style=\"text-align:left;\"> Size of the reconstruction matrix in pixels </td>\n   <td style=\"text-align:left;\"> array of three numbers </td>\n   <td style=\"text-align:left;\"> [1,1,2] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Reconstruction </td>\n   <td style=\"text-align:left;\"> ReconMethodNameMethodName </td>\n   <td style=\"text-align:left;\"> Reconstruction method or algorithm. Corresponds to DICOM Tag 0054,1103.  </td>\n   <td style=\"text-align:left;\"> string </td>\n   <td style=\"text-align:left;\"> dummy-method </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Reconstruction </td>\n   <td style=\"text-align:left;\"> MethodImplementationVersion  </td>\n   <td style=\"text-align:left;\"> Identification for the software used, such as name and version (optional)  </td>\n   <td style=\"text-align:left;\"> string </td>\n   <td style=\"text-align:left;\"> in-house-bash-script-v02 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Reconstruction </td>\n   <td style=\"text-align:left;\"> FilterType  </td>\n   <td style=\"text-align:left;\"> Type of post-recon smoothing  </td>\n   <td style=\"text-align:left;\"> string </td>\n   <td style=\"text-align:left;\"> gaussian </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\n## Subject information\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# check \nknitr::kable(subj_info) %>%\n  scroll_box(height= \"300px\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; \"><table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> subjID </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> Sex </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> Body.weight.(g) </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> length.(mm) </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> Dilut.(x) </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> Con.(mg.Ba/ml) </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> Int.1.rate.(uL/min) </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> Int.2.vol.(uL) </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> time.(HH:MM) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> DS01 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 27.50 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.8666667 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS02 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 26.60 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.4680556 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS03 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 27.50 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.10 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.4173611 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS04 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 20.20 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.9777778 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS05 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 20.20 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.7993056 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS06 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 20.30 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.7006944 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS07 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 26.40 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.10 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.6284722 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS08 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 24.60 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 26.80 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.8402778 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS10 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 25.70 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.7069444 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS11 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 24.40 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 1.50 </td>\n   <td style=\"text-align:right;\"> 123 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.6895833 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS12 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 25.30 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 111 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.5312500 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS13 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 24.70 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 111 </td>\n   <td style=\"text-align:right;\"> 0.10 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.7083333 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS14 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 27.00 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 111 </td>\n   <td style=\"text-align:right;\"> 0.10 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.9569444 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS15 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 24.00 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 111 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.8638889 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS16 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 25.80 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 111 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.4118056 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS17 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 26.40 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 111 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS18 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 26.60 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.5805556 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS19 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 26.90 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.4722222 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS20 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 26.20 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.6520833 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS21 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 21.00 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.5486111 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS22 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 19.50 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.10 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.7812500 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS23 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 19.60 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.10 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.7611111 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS24 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 19.56 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.8715278 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS25 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 19.63 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.6125000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS26 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 19.71 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.5375000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS27 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 19.20 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.9298611 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS28 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 20.20 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.7451389 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS29 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 18.60 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.10 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.4687500 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS30 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 19.03 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.6833333 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS31 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 20.50 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 13.3800000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS32 </td>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:right;\"> 20.20 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.10 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.6256944 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS33 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 21.20 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0.8361111 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS34 </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:right;\"> 19.21 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 321 </td>\n   <td style=\"text-align:right;\"> 0.10 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 0.7090278 </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\n## Filenames\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# check \nknitr::kable(tbl_files) %>%\n  scroll_box(height= \"300px\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; \"><table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> fname </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> subject </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> DS01_statB_1scan_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS01 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS02_statB_1scan-v3_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS02 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS03_statB_1scan_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS04_statB_1scan_v2_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS04_statB_1scan_v3_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS05_statB_1scan_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS05 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS06_statB_1scan_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS06 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS07_statB_1scan_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS07 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS08_statB_1scan_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS08 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_1scan-head_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_1scan-neck_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_1scan-nose-v2_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_1scan-nose_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_001_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_002_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_003_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_004_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_005_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_006_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_007_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_008_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_009_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_010_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_011_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_012_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_013_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_014_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_015_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_016_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_017_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_018_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_019_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DS09_statA_20scan-ph1-Int_020_slc1234.jpg </td>\n   <td style=\"text-align:left;\"> DS09 </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n:::\n\n### Create the JSON files\n\n#### Prepare table\n\nPrepare the human-readable table specifying the JSON fields into a suitable format to read with `jsonlite::toJSON()`\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\n# Preserve the sorting of the field names as in the table\nsorted_fieldnames <- factor(jsonFields$Data.name, levels = jsonFields$Data.name) \n\n# Transform table into a list. Each element is a fieldname with its values\njson_data <- lapply(split(jsonFields$Permissible.values,sorted_fieldnames),as.character)\n```\n:::\n\n\n#### Add file-specific information\n\nLoop through the image files and fill the file-specific values in the JSON file with information from the table with subject info.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(jsonlite)\n\n# Join tables with filenames and subject information by subjID\nmetadat <- dplyr::full_join(x=tbl_files, y=subj_info, by=join_by('subject'=='subjID'),keep=FALSE)  \n\n# write JSON files \nsaveoutput <- 0\nfor (i in 1:nrow(tbl_files)) {\n  \n  # Complete Fields with info From table \n  json_data$IntendedFor = metadat$fname[i]\n  json_data$SubjectID = metadat$subject[i]\n  json_data$Sex = metadat$Sex[i]\n  json_data$BodyWeight_gr = metadat$`Body.weight.(g)`[i]\n  \n  \n  # Convert the list to a JSON string\n  json_string <- toJSON(json_data, pretty = TRUE, auto_unbox = TRUE)\n  \n  # Save the JSON string to a file\n  if (saveoutput == 1) {\n    ouputfilename <- gsub('.jpg','.json',tbl_files$fname[i]) # rename input file\n    write(json_string, file.path(diroutput, ouputfilename))  \n    print(paste0(\"Wrote \", file.path(diroutput, ouputfilename)))\n  }\n  \n  # clean json \n  rm (json_string)\n}\n```\n:::\n\n\n#### Output Examples\n\nThe r package `jsonlite` offers several formatting options. Depending on your needs you may have some preferences.\n\n::: panel-tabset\n### JSON with auto_unbox = TRUE\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(toJSON(json_data, pretty = TRUE, auto_unbox = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n{\n  \"SynchrotronName\": \"Dummy-synchrotron\",\n  \"SynchrotronAcronym\": \"Sync1234\",\n  \"IntendedFor\": \"DS09_statA_20scan-ph1-Int_020_slc1234.jpg\",\n  \"BeamlineAcronym\": \"BL20B2\",\n  \"BeamtimeSessionStartDate\": \"2024-01-13\",\n  \"BeamtimeSessionEndDate\": \"2024-01-13\",\n  \"SpeciesName\": \"mouse (mus musculus)\",\n  \"SpeciesStrain\": \"C123456 \",\n  \"SubjectID\": \"DS09\",\n  \"Sex\": \"F\",\n  \"BodyWeight_gr\": 26.8,\n  \"BodyPart\": \"brain\",\n  \"DetectorArrayWidth\": \"123\",\n  \"DetectorArrayHeight\": \"456\",\n  \"DetectorBitDepth\": \"16\",\n  \"DetectorPixelSize\": \"6\",\n  \"RotationAngle\": \"180\",\n  \"CenterOfRotationMethod\": \"manual\",\n  \"CenterOfRotationValue\": \"3\",\n  \"ReconMatrixSize \": \"[1,1,2]\",\n  \"ReconMethodNameMethodName\": \"dummy-method\",\n  \"MethodImplementationVersion \": \"in-house-bash-script-v02\",\n  \"FilterType \": \"gaussian\"\n} \n```\n\n\n:::\n:::\n\n\n### JSON with auto_unbox = FALSE\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(toJSON(json_data, pretty = TRUE, auto_unbox = FALSE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n{\n  \"SynchrotronName\": [\"Dummy-synchrotron\"],\n  \"SynchrotronAcronym\": [\"Sync1234\"],\n  \"IntendedFor\": [\"DS09_statA_20scan-ph1-Int_020_slc1234.jpg\"],\n  \"BeamlineAcronym\": [\"BL20B2\"],\n  \"BeamtimeSessionStartDate\": [\"2024-01-13\"],\n  \"BeamtimeSessionEndDate\": [\"2024-01-13\"],\n  \"SpeciesName\": [\"mouse (mus musculus)\"],\n  \"SpeciesStrain\": [\"C123456 \"],\n  \"SubjectID\": [\"DS09\"],\n  \"Sex\": [\"F\"],\n  \"BodyWeight_gr\": [26.8],\n  \"BodyPart\": [\"brain\"],\n  \"DetectorArrayWidth\": [\"123\"],\n  \"DetectorArrayHeight\": [\"456\"],\n  \"DetectorBitDepth\": [\"16\"],\n  \"DetectorPixelSize\": [\"6\"],\n  \"RotationAngle\": [\"180\"],\n  \"CenterOfRotationMethod\": [\"manual\"],\n  \"CenterOfRotationValue\": [\"3\"],\n  \"ReconMatrixSize \": [\"[1,1,2]\"],\n  \"ReconMethodNameMethodName\": [\"dummy-method\"],\n  \"MethodImplementationVersion \": [\"in-house-bash-script-v02\"],\n  \"FilterType \": [\"gaussian\"]\n} \n```\n\n\n:::\n:::\n\n:::\n\n# Code\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nlibrary(knitr)\nlibrary(dplyr)\nlibrary(kableExtra)\n\n# Enter input directories \ndirinput <- 'dummy_data'\ndiroutput <- '../../_data/'\n\n# Read table with JSON fields \njsonFields <- read.csv(file.path(dirinput,'Dummy_JSON_fields.csv'))\n\n# Read table with subject information\nsubj_info <- openxlsx::read.xlsx(file.path(dirinput,'DummyData1_20241234_subjects.xlsx'), sheet = 'subject_info')\n\n# Create table filenames \nfiles <- dir(file.path(dirinput,'Images')) # Find all files in our images folder\n\n# Use pattern to take only subject images\nfname <- files[grepl(paste0('^DS.*.jpg$'),files)] \ntbl_files <- as.data.frame(fname) \n\n# First filename part contains subject ID\ntbl_files$subject <- sapply(strsplit(fname,'_'),'[[',1) \n# Preserve the sorting of the field names as in the table\nsorted_fieldnames <- factor(jsonFields$Data.name, levels = jsonFields$Data.name) \n\n# Transform table into a list. Each element is a fieldname with its values\njson_data <- lapply(split(jsonFields$Permissible.values,sorted_fieldnames),as.character)\n\nlibrary(jsonlite)\n\n# Join tables with filenames and subject information by subjID\nmetadat <- dplyr::full_join(x=tbl_files, y=subj_info, by=join_by('subject'=='subjID'),keep=FALSE)  \n\n# write JSON files \nsaveoutput <- 0\nfor (i in 1:nrow(tbl_files)) {\n  \n  # Complete Fields with info From table \n  json_data$IntendedFor = metadat$fname[i]\n  json_data$SubjectID = metadat$subject[i]\n  json_data$Sex = metadat$Sex[i]\n  json_data$BodyWeight_gr = metadat$`Body.weight.(g)`[i]\n  \n  \n  # Convert the list to a JSON string\n  json_string <- toJSON(json_data, pretty = TRUE, auto_unbox = TRUE)\n  \n  # Save the JSON string to a file\n  if (saveoutput == 1) {\n    ouputfilename <- gsub('.jpg','.json',tbl_files$fname[i]) # rename input file\n    write(json_string, file.path(diroutput, ouputfilename))  \n    print(paste0(\"Wrote \", file.path(diroutput, ouputfilename)))\n  }\n  \n  # clean json \n  rm (json_string)\n}\n```\n:::\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}